# ูุณุชูุฏุงุช ุงูฺฏูุฑุชูโูุง GraphRAG

## ููุฏูู

ุงู ูุณุชูุฏุงุช ูุญูู ูพุงุฏูโุณุงุฒ ู ุนููฺฉุฑุฏ ุงูฺฏูุฑุชูโูุง ูุฎุชูู GraphRAG ุฑุง ุชูุถุญ ูโุฏูุฏ. ูุฑ ุงูฺฏูุฑุชู ุจุฑุง ููุน ุฎุงุต ุงุฒ ุณูุงูุงุช ู ุฏุงุฏูโูุง ุจูููโุณุงุฒ ุดุฏู ุงุณุช.

## 1. KGSearch (ุงูฺฏูุฑุชู ุงุตู ุฌุฏุฏ)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `graphrag_new/search.py`
- ฺฉูุงุณ: `KGSearch`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
class KGSearch(Dealer):
    def retrieval(self, question: str, tenant_ids: str | list[str], kb_ids: list[str], 
                  emb_mdl, llm, max_token: int = 8196, ent_topn: int = 6, 
                  rel_topn: int = 6, comm_topn: int = 1, **kwargs):
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ุชุญูู ุณูุงู:** ุงุณุชุฎุฑุงุฌ ฺฉููุงุช ฺฉูุฏ ู ููุฌูุฏุชโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ LLM
2. **ุฌุณุชุฌู ููุฌูุฏุชโูุง:** ุงูุชู ููุฌูุฏุชโูุง ูุฑุชุจุท ุจุฑ ุงุณุงุณ ุดุจุงูุช ูุนูุง
3. **ุฌุณุชุฌู ุฑูุงุจุท:** ุงูุชู ุฑูุงุจุท ูุฑุชุจุท ุจู ููุฌูุฏุชโูุง
4. **ุชุดุฎุต ุฌุงูุนูโูุง:** ฺฏุฑููโุจูุฏ ููุฌูุฏุชโูุง ูุฑุชุจุท
5. **ุชููุฏ ูุชู ุฒููู:** ุชุฑฺฉุจ ุงุทูุงุนุงุช ุจุฑุง ุชููุฏ ูพุงุณุฎ

### ๐ฏ **ููุงุท ููุช:**
- ุงุณุชูุงุฏู ุงุฒ LLM ุจุฑุง ุชุญูู ููุดููุฏ ุณูุงูุงุช
- ุชุฑฺฉุจ ุฌุณุชุฌู ูุนูุง ู ุณุงุฎุชุงุฑ
- ูพุดุชุจุงู ุงุฒ ุชุดุฎุต ุฌุงูุนูโูุง
- ุงูุนุทุงูโูพุฐุฑ ุจุงูุง ุฏุฑ ุชูุธูุงุช

---

## 2. N-Hop Retrieval (ุจุงุฒุงุจ ฺูุฏูุฑุญููโุง)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `enhanced_graphrag_service.py`
- ูุชุฏ: `n_hop_retrieval()`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
def n_hop_retrieval(self, query: str, start_nodes: List[str]) -> Dict:
    """ุจุงุฒุงุจ ฺูุฏูุฑุญููโุง ุจุง ุฌุณุชุฌู ุนูู ุฏุฑ ฺฏุฑุงู"""
    paths = self._find_n_hop_paths(start_nodes[0], self.config.max_depth)
    return {
        "nodes": self._extract_nodes_from_paths(paths),
        "edges": self._extract_edges_from_paths(paths),
        "paths": paths,
        "method": "N-Hop Retrieval"
    }
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ุดุฑูุน ุงุฒ ููุฏูุง ุงููู:** ุงูุชุฎุงุจ ููุฏูุง ุดุฑูุน ุจุฑ ุงุณุงุณ ุณูุงู
2. **ุฌุณุชุฌู ุนูู:** ุงุณุชูุงุฏู ุงุฒ DFS ุจุฑุง ุงูุชู ูุณุฑูุง ูุฎุชูู
3. **ฺฉูุชุฑู ุนูู:** ูุญุฏูุฏ ฺฉุฑุฏู ุนูู ุฌุณุชุฌู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงูุดุนุงุจ ุฒุงุฏ
4. **ููุชุฑ ฺฉุฑุฏู ูุชุงุฌ:** ุญุฐู ูุณุฑูุง ูุงูุฑุชุจุท

### ๐ฏ **ููุงุท ููุช:**
- ฺฉุดู ุฑูุงุจุท ูพฺุฏู ู ุบุฑูุณุชูู
- ููุงุณุจ ุจุฑุง ุณูุงูุงุช ฺูุฏูุฑุญููโุง
- ฺฉูุชุฑู ุฏูู ุนูู ุฌุณุชุฌู

---

## 3. PageRank-Based (ุจุฑ ุงุณุงุณ ุงููุช)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `enhanced_graphrag_service.py`
- ูุชุฏ: `pagerank_retrieval()`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
def pagerank_retrieval(self, query: str, start_nodes: List[str]) -> Dict:
    """ุจุงุฒุงุจ ุจุฑ ุงุณุงุณ ุงููุช ููุฏูุง ุจุง ุงุณุชูุงุฏู ุงุฒ PageRank"""
    pagerank_scores = nx.pagerank(self.G, alpha=self.config.pagerank_alpha)
    relevant_nodes = self._get_top_pagerank_nodes(pagerank_scores, start_nodes)
    return {
        "nodes": relevant_nodes,
        "method": "PageRank-Based"
    }
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ูุญุงุณุจู PageRank:** ุชุนู ุงููุช ููุฏูุง ุฏุฑ ฺฏุฑุงู
2. **ููุชุฑ ฺฉุฑุฏู:** ุงูุชุฎุงุจ ููุฏูุง ูุฑุชุจุท ุจุง ุณูุงู
3. **ุฑุชุจูโุจูุฏ:** ูุฑุชุจโุณุงุฒ ุจุฑ ุงุณุงุณ ุงูุชุงุฒ PageRank
4. **ุงุณุชุฎุฑุงุฌ ุฑูุงุจุท:** ุงูุชู ุฑูุงุจุท ุจู ููุฏูุง ููู

### ๐ฏ **ููุงุท ููุช:**
- ุดูุงุณุง ููุฏูุง ฺฉูุฏ ู ููู
- ููุงุณุจ ุจุฑุง ุณูุงูุงุช ุนููู
- ููุงูู ุฏุฑ ุจุฑุงุจุฑ ููุฒ

---

## 4. Semantic Similarity (ุดุจุงูุช ูุนูุง)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `enhanced_graphrag_service.py`
- ูุชุฏ: `semantic_similarity_retrieval()`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
def semantic_similarity_retrieval(self, query: str, start_nodes: List[str]) -> Dict:
    """ุจุงุฒุงุจ ุจุฑ ุงุณุงุณ ุดุจุงูุช ูุนูุง"""
    similarities = {}
    for node in self.G.nodes():
        similarity = self._calculate_simple_similarity(query, node)
        if similarity > self.config.similarity_threshold:
            similarities[node] = similarity
    
    top_nodes = sorted(similarities.items(), key=lambda x: x[1], reverse=True)
    return {
        "nodes": top_nodes[:self.config.max_nodes],
        "method": "Semantic Similarity"
    }
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ูุญุงุณุจู ุดุจุงูุช:** ููุงุณู ุณูุงู ุจุง ุชูุงู ููุฏูุง
2. **ููุชุฑ ฺฉุฑุฏู:** ุงูุชุฎุงุจ ููุฏูุง ุจุง ุดุจุงูุช ุจุงูุง
3. **ุฑุชุจูโุจูุฏ:** ูุฑุชุจโุณุงุฒ ุจุฑ ุงุณุงุณ ูุฒุงู ุดุจุงูุช
4. **ุงุณุชุฎุฑุงุฌ ุฑูุงุจุท:** ุงูุชู ุฑูุงุจุท ุจู ููุฏูุง ูุดุงุจู

### ๐ฏ **ููุงุท ููุช:**
- ููุงุณุจ ุจุฑุง ุณูุงูุงุช ููููู
- ฺฉุดู ุฑูุงุจุท ูุนูุง
- ุงูุนุทุงูโูพุฐุฑ ุฏุฑ ุชุดุฎุต ุดุจุงูุช

---

## 5. Community Detection (ุชุดุฎุต ุฌุงูุนูโูุง)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `enhanced_graphrag_service.py`
- ูุชุฏ: `community_detection_retrieval()`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
def community_detection_retrieval(self, query: str, start_nodes: List[str]) -> Dict:
    """ุจุงุฒุงุจ ุจุฑ ุงุณุงุณ ุชุดุฎุต ุฌุงูุนูโูุง"""
    if self.config.community_detection_method == CommunityDetectionMethod.LOUVAIN:
        communities = community_louvain.best_partition(self.G, resolution=self.config.community_resolution)
    
    relevant_communities = self._find_relevant_communities(communities, start_nodes)
    return {
        "nodes": self._extract_nodes_from_communities(relevant_communities),
        "communities": relevant_communities,
        "method": "Community Detection"
    }
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ุชุดุฎุต ุฌุงูุนูโูุง:** ุงุณุชูุงุฏู ุงุฒ ุงูฺฏูุฑุชูโูุง ูุฎุชูู (Louvain, Label Propagation)
2. **ุงูุชู ุฌุงูุนูโูุง ูุฑุชุจุท:** ุงูุชุฎุงุจ ุฌุงูุนูโูุง ฺฉู ุดุงูู ููุฏูุง ุดุฑูุน ูุณุชูุฏ
3. **ุงุณุชุฎุฑุงุฌ ููุฏูุง:** ุฌูุนโุขูุฑ ุชูุงู ููุฏูุง ุฌุงูุนูโูุง ูุฑุชุจุท
4. **ููุชุฑ ฺฉุฑุฏู:** ุญุฐู ุฌุงูุนูโูุง ูุงูุฑุชุจุท

### ๐ฏ **ููุงุท ููุช:**
- ฺฉุดู ฺฏุฑููโูุง ูุฑุชุจุท
- ููุงุณุจ ุจุฑุง ุณูุงูุงุช ุฌุงูุน
- ฺฉุงูุด ูพฺุฏฺฏ ูุญุงุณุจุงุช

---

## 6. Entity Resolution (ุญู ููุฌูุฏุชโูุง)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `graphrag_new/entity_resolution.py`
- ฺฉูุงุณ: `EntityResolution`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
class EntityResolution:
    def __init__(self, similarity_threshold: float = 0.8):
        self.similarity_threshold = similarity_threshold
        self.resolved_entities = {}
    
    def find_similar_entities(self, entities: List[str]) -> List[List[str]]:
        """ุงูุชู ฺฏุฑููโูุง ููุฌูุฏุชโูุง ูุดุงุจู"""
        groups = []
        processed = set()
        
        for entity1 in entities:
            if entity1 in processed:
                continue
            
            group = [entity1]
            processed.add(entity1)
            
            for entity2 in entities:
                if entity2 in processed:
                    continue
                
                similarity = self.calculate_similarity(entity1, entity2)
                if similarity >= self.similarity_threshold:
                    group.append(entity2)
                    processed.add(entity2)
            
            if len(group) > 1:
                groups.append(group)
        
        return groups
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ูุญุงุณุจู ุดุจุงูุช:** ููุงุณู ููุฌูุฏุชโูุง ุจุง ฺฉุฏฺฏุฑ
2. **ุชุดุฎุต ูุชุฑุงุฏูโูุง:** ุดูุงุณุง ููุฌูุฏุชโูุง ูุดุงุจู
3. **ฺฏุฑููโุจูุฏ:** ุงุฌุงุฏ ฺฏุฑููโูุง ููุฌูุฏุชโูุง ูุดุงุจู
4. **ฺฉูพุงุฑฺูโุณุงุฒ:** ุงุฏุบุงู ููุฌูุฏุชโูุง ูุดุงุจู

### ๐ฏ **ููุงุท ููุช:**
- ฺฉุงูุด ุชฺฉุฑุงุฑ ุฏุฑ ุฏุงุฏูโูุง
- ุจูุจูุฏ ฺฉูุช ุฌุณุชุฌู
- ฺฉูพุงุฑฺูโุณุงุฒ ุงุทูุงุนุงุช

---

## 7. Hybrid New (ุชุฑฺฉุจ ุฑูุดโูุง ุฌุฏุฏ)

### ๐ **ูููุนุช ูพุงุฏูโุณุงุฒ:**
- ูุงู: `enhanced_graphrag_service.py`
- ูุชุฏ: `hybrid_retrieval()`

### ๐ง **ูุญูู ฺฉุงุฑ:**
```python
def hybrid_retrieval(self, query: str, start_nodes: List[str]) -> Dict:
    """ุชุฑฺฉุจ ุฑูุดโูุง ูุฎุชูู ุจุฑุง ุจูุชุฑู ูุชุฌู"""
    results = {}
    
    # ุงุฌุฑุง ุชูุงู ุฑูุดโูุง
    if self.config.enable_semantic_search:
        results['semantic'] = self.semantic_similarity_retrieval(query, start_nodes)
    
    if self.config.enable_community_detection:
        results['community'] = self.community_detection_retrieval(query, start_nodes)
    
    if self.config.enable_n_hop_search:
        results['n_hop'] = self.n_hop_retrieval(query, start_nodes)
    
    # ุชุฑฺฉุจ ูุชุงุฌ
    combined_nodes = self._combine_results(results)
    return {
        "nodes": combined_nodes,
        "method": "Hybrid New",
        "sub_methods": list(results.keys())
    }
```

### ๐ **ูุฑุงุญู ุงุฌุฑุง:**
1. **ุงุฌุฑุง ููุงุฒ:** ุงุฌุฑุง ฺูุฏู ุงูฺฏูุฑุชู ุจู ุตูุฑุช ููุฒูุงู
2. **ุฌูุนโุขูุฑ ูุชุงุฌ:** ุฌูุนโุขูุฑ ูุชุงุฌ ุงุฒ ุชูุงู ุฑูุดโูุง
3. **ุชุฑฺฉุจ ููุดููุฏ:** ุชุฑฺฉุจ ูุชุงุฌ ุจุง ูุฒูโุฏู ููุงุณุจ
4. **ููุชุฑ ููุง:** ุญุฐู ูุชุงุฌ ุชฺฉุฑุงุฑ ู ูุงูุฑุชุจุท

### ๐ฏ **ููุงุท ููุช:**
- ุจูุชุฑู ูุชุฌู ุจุง ุชุฑฺฉุจ ุฑูุดโูุง
- ุงูุนุทุงูโูพุฐุฑ ุจุงูุง
- ูพูุดุด ฺฉุงูู ุงููุงุน ุณูุงูุงุช

---

## ููุงุณู ุงูฺฏูุฑุชูโูุง

| ุงูฺฏูุฑุชู | ุณุฑุนุช | ุฏูุช | ูพฺุฏฺฏ | ููุงุณุจ ุจุฑุง |
|----------|------|------|---------|------------|
| KGSearch | ูุชูุณุท | ุจุงูุง | ูุชูุณุท | ุณูุงูุงุช ุนููู |
| N-Hop | ฺฉูุฏ | ุจุงูุง | ุจุงูุง | ุณูุงูุงุช ูพฺุฏู |
| PageRank | ุณุฑุน | ูุชูุณุท | ูพุงู | ุณูุงูุงุช ุนููู |
| Semantic | ุณุฑุน | ูุชูุณุท | ูพุงู | ุณูุงูุงุช ููููู |
| Community | ูุชูุณุท | ุจุงูุง | ูุชูุณุท | ุณูุงูุงุช ุฌุงูุน |
| Entity Resolution | ูุชูุณุท | ุจุงูุง | ูุชูุณุท | ูพุงฺฉุณุงุฒ ุฏุงุฏูโูุง |
| Hybrid | ฺฉูุฏ | ุจุณุงุฑ ุจุงูุง | ุจุงูุง | ุณูุงูุงุช ูพฺุฏู |

---

## ูุญูู ุงุณุชูุงุฏู

### ุงูุชุฎุงุจ ุงูฺฏูุฑุชู ููุงุณุจ:

1. **ุณูุงูุงุช ุณุงุฏู:** PageRank ุง Semantic Similarity
2. **ุณูุงูุงุช ูพฺุฏู:** N-Hop ุง Hybrid
3. **ุณูุงูุงุช ุฌุงูุน:** Community Detection
4. **ูพุงฺฉุณุงุฒ ุฏุงุฏูโูุง:** Entity Resolution
5. **ุงุณุชูุงุฏู ุนููู:** KGSearch

### ุชูุธูุงุช ูพุดููุงุฏ:

```python
# ุจุฑุง ุณูุงูุงุช ุณุงุฏู
config = {
    "retrieval_algorithm": "PAGERANK_BASED",
    "max_nodes": 10,
    "similarity_threshold": 0.3
}

# ุจุฑุง ุณูุงูุงุช ูพฺุฏู
config = {
    "retrieval_algorithm": "HYBRID",
    "enable_semantic_search": True,
    "enable_community_detection": True,
    "enable_n_hop_search": True,
    "max_depth": 3
}
```

---

## ูฺฉุงุช ููู ูพุงุฏูโุณุงุฒ

1. **ฺฉุด ฺฉุฑุฏู:** ุงุณุชูุงุฏู ุงุฒ ฺฉุด ุจุฑุง ุจูุจูุฏ ุณุฑุนุช
2. **ููุงุฒโุณุงุฒ:** ุงุฌุฑุง ููุฒูุงู ุงูฺฏูุฑุชูโูุง ูุณุชูู
3. **ููุชุฑ ฺฉุฑุฏู:** ุญุฐู ูุชุงุฌ ูุงูุฑุชุจุท ุฏุฑ ูุฑุงุญู ูุฎุชูู
4. **ูุฒูโุฏู:** ุงุณุชูุงุฏู ุงุฒ ูุฒูโูุง ููุงุณุจ ุจุฑุง ุชุฑฺฉุจ ูุชุงุฌ
5. **ุจูููโุณุงุฒ:** ุชูุธู ูพุงุฑุงูุชุฑูุง ุจุฑ ุงุณุงุณ ููุน ุฏุงุฏูโูุง

---

## ูุชุฌูโฺฏุฑ

ูุฑ ุงูฺฏูุฑุชู ุจุฑุง ููุน ุฎุงุต ุงุฒ ุณูุงูุงุช ู ุฏุงุฏูโูุง ุจูููโุณุงุฒ ุดุฏู ุงุณุช. ุงูุชุฎุงุจ ุงูฺฏูุฑุชู ููุงุณุจ ุจุฑ ุงุณุงุณ:
- ููุน ุณูุงู
- ูพฺุฏฺฏ ุฏุงุฏูโูุง
- ูุงุฒูุง ุณุฑุนุช ู ุฏูุช
- ููุงุจุน ููุฌูุฏ

ุชุฑฺฉุจ ููุดููุฏ ุงู ุงูฺฏูุฑุชูโูุง ูโุชูุงูุฏ ุจูุชุฑู ูุชุงุฌ ุฑุง ุงุฑุงุฆู ุฏูุฏ. 